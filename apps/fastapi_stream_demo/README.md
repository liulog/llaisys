### Note

Here is a demo generated by chatgpt.

Streaming output based on fastapi and requests.

##### Usage

1. Start the service

```bash
❯ uvicorn main:app --reload
INFO:     Will watch for changes in these directories: ['/home/jingyu/workspace/infinitensor/llaisys/apps/fastapi_stream_demo']
INFO:     Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)
INFO:     Started reloader process [233813] using WatchFiles
INFO:     Started server process [233815]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
Received request: model='dummy_model' messages=[Message(role='user', content='Hello, how are you?'), Message(role='user', content='What can you do?')] stream=True
INFO:     127.0.0.1:55506 - "POST /infer HTTP/1.1" 200 OK
Sending response 1
Sending response 2
Sending response 3
Sending response 4
Sending response 5
```

2. Request through http://127.0.0.1:8000/

```bash
❯ python stream_test.py
Response received successfully
Raw line: b'{"id": "4f8eb0b2-3b19-424d-afea-5324690718e8", "created": 1758882058, "model": "dummy_model", "choices": [{"message": {"role": "assistant", "content": "Response 1"}, "finish_reason": "stop", "index": 0}]}'
Received: {'id': '4f8eb0b2-3b19-424d-afea-5324690718e8', 'created': 1758882058, 'model': 'dummy_model', 'choices': [{'message': {'role': 'assistant', 'content': 'Response 1'}, 'finish_reason': 'stop', 'index': 0}]}
Raw line: b'{"id": "c7e28330-fdfd-4030-8f85-e3a4e6557f3b", "created": 1758882059, "model": "dummy_model", "choices": [{"message": {"role": "assistant", "content": "Response 2"}, "finish_reason": "stop", "index": 0}]}'
Received: {'id': 'c7e28330-fdfd-4030-8f85-e3a4e6557f3b', 'created': 1758882059, 'model': 'dummy_model', 'choices': [{'message': {'role': 'assistant', 'content': 'Response 2'}, 'finish_reason': 'stop', 'index': 0}]}
Raw line: b'{"id": "3abdeaed-b951-4896-97b4-4dd0dfdf7956", "created": 1758882060, "model": "dummy_model", "choices": [{"message": {"role": "assistant", "content": "Response 3"}, "finish_reason": "stop", "index": 0}]}'
Received: {'id': '3abdeaed-b951-4896-97b4-4dd0dfdf7956', 'created': 1758882060, 'model': 'dummy_model', 'choices': [{'message': {'role': 'assistant', 'content': 'Response 3'}, 'finish_reason': 'stop', 'index': 0}]}
Raw line: b'{"id": "1a14359a-287a-4ad2-839a-a3fec6522ea2", "created": 1758882061, "model": "dummy_model", "choices": [{"message": {"role": "assistant", "content": "Response 4"}, "finish_reason": "stop", "index": 0}]}'
Received: {'id': '1a14359a-287a-4ad2-839a-a3fec6522ea2', 'created': 1758882061, 'model': 'dummy_model', 'choices': [{'message': {'role': 'assistant', 'content': 'Response 4'}, 'finish_reason': 'stop', 'index': 0}]}
Raw line: b'{"id": "2975a79f-768c-40fa-828b-f0d8e0a33733", "created": 1758882062, "model": "dummy_model", "choices": [{"message": {"role": "assistant", "content": "Response 5"}, "finish_reason": "stop", "index": 0}]}'
Received: {'id': '2975a79f-768c-40fa-828b-f0d8e0a33733', 'created': 1758882062, 'model': 'dummy_model', 'choices': [{'message': {'role': 'assistant', 'content': 'Response 5'}, 'finish_reason': 'stop', 'index': 0}]}
```